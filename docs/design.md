# 設計書 (Design Document)

## 1. システムアーキテクチャ

### 1.1 技術スタック
*   **言語**: Rust (Frontend & Backend)
*   **フロントエンド**: WebAssembly (WASM)
    *   フレームワーク: **Leptos** (または Yew)
    *   スタイリング: TailwindCSS
*   **バックエンド / インフラ**:
    *   ランタイム: **Cloudflare Workers** (Rust `workers-rs`)
    *   デプロイ: Cloudflare Pages (Frontend) + Workers (API)

### 1.2 構成図
```mermaid
graph LR
    User[ユーザー (Browser)] -- HTTPS/WASM --> CF[Cloudflare Pages (Frontend)]
    User -- API Request --> Worker[Cloudflare Worker (API)]
    Worker -- Fetch --> ExtAPI[外部金融API (Yahoo/AlphaVantage等)]
    Worker -- Cache --> KV[Cloudflare KV (キャッシュ)]
```

## 2. データフロー設計

### Phase 1 (プロトタイプ)
1.  クライアント(WASM)が `GET /api/market-data` を叩く。
2.  Workerは内部で生成した**モックデータ** (乱数または固定値) をJSONとして返す。
3.  クライアントがデータをパースし、画面に描画する。

### Phase 2 (本番データ連携)
1.  **定期実行 (Cron)**: Workerは外部APIから **12時間おき** にデータを取得。
2.  **手動更新**: ユーザーが画面上の「更新ボタン」を押すと、強制的に最新データをフェッチしてキャッシュを更新する。
3.  取得したデータを Cloudflare KV にキャッシュする。
4.  クライアントからのリクエストには KV から高速にレスポンスを返す。

## 3. コンポーネント設計 (Frontend)

### `App`
*   アプリケーションのルート。レイアウト枠を提供。

### `MarketGrid`
*   レスポンシブなグリッドコンテナ。スマホでは1列、PCでは3〜4列等に可変。

### `AssetCard`
*   個別の指数を表示するカードコンポーネント。
*   **Props**: `AssetIndex` (名前, 価格, 前日比, カテゴリ)
*   **View**:
    *   緑色/赤色の文字色で騰落を表現。
    *   カテゴリごとのアイコン表示。

## 5. UI/UX デザイン戦略
**コンセプト**: "Modern Financial Cockpit"
金融端末のようなプロフェッショナルさと、コンシューマーアプリの使いやすさを両立する。

### 5.1 デザイン原則
1.  **Bento Grid Layout (弁当箱グリッド)**:
    *   各資産クラスをカード状のモジュールに分割し、画面サイズに応じて滑らかに再配置する。
    *   重要な指標（S&P500など）は大きく、補足的な指標は小さく表示し、視覚的な強弱をつける。
2.  **Dark Mode First**:
    *   目に優しく、数字が映える「ダークモード」をデフォルトとする。
    *   背景色: 深いブルーグレー (e.g., Slate-900)
    *   アクセント: 鮮やかな緑（上昇）、赤（下落）を使用し、直感的な認識を促す。
3.  **Glanceability (一目での視認性)**:
    *   **ヒートマップ・カラーリング**: Finvizを参考に、騰落率に応じて背景色の彩度を変化させる。
        *   +3%以上: 鮮やかな緑
        *   +0.5%以内: グレーに近い緑/赤
        *   -3%以下: 鮮やかな赤
    *   数値よりも「色」で市場全体の雰囲気を伝える。

### 5.2 インタラクション
*   **ホバーエフェクト**: カードにカーソルを合わせると、過去5日間のミニチャート（スパークライン）や関連ニュース見出しが浮き上がる。
*   **ドリルダウン**: カードをクリックすると、詳細ビュー（Time Machineチャートや相関データ）へシームレスに遷移する。
*   **手動更新ボタン**: 画面右上に「最新情報を取得」ボタンを配置。押下時にローディングアニメーションを表示。
*   **ドラッグ＆ドロップ**: ユーザーが監視したい指数の配置を自由にカスタマイズ可能にする（Personalization）。
